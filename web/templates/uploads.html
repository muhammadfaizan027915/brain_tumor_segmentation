{% extends "base.html" %}
{% block content %}


<div class="card main-card p-5 mx-auto upload-card">

    <h5 class="text-center mb-2 txt-color">Upload Your Scans</h5>
    <p class="text-center text-muted txt-size">Upload your MRI scans for tumor segmentation</p>

    <form method="post" action="{{ url_for('Uploads.upload_file') }}" enctype="multipart/form-data">
        <div class="upload-box mx-auto" id="drop-area">
            <i class="fa fa-upload upload-icon"></i>

            <p class="choose-text">Choose file or drag and drop it here!</p>
            <p class="meta-text">NIfTI, NII, PNG, JPG â€” max 600MB</p>

            <label class="browse-link">
                Browse
                <input type="file" name="file" id="file-input" hidden>
            </label>
        </div>

        <div class="row mt-4 preview-row justify-content-center" id="preview-row"></div>

        <button class="submit-btn mt-4 mx-auto d-block upload-btn" id="submit-scan" disabled>Upload</button>
    </form>
</div>

<script>
    const fileInput = document.getElementById("file-input");
    const dropArea = document.getElementById("drop-area");
    const previewRow = document.getElementById("preview-row");
    const submitBtn = document.getElementById("submit-scan")

    fileInput.addEventListener("change", e => {
        const file = e.target.files[0]

        if (file) {
            showPreview(file)
            submitBtn.removeAttribute("disabled")
        }

    });

    dropArea.addEventListener("dragover", e => { e.preventDefault(); dropArea.classList.add("drag-hover"); });
    dropArea.addEventListener("dragleave", () => dropArea.classList.remove("drag-hover"));
    dropArea.addEventListener("drop", e => {
        e.preventDefault();
        dropArea.classList.remove("drag-hover");
        showPreview(e.dataTransfer.files[0]);
    });

    function showPreview(file) {
        let url = URL.createObjectURL(file);
        previewRow.innerHTML = `
        <div class="col-md-4 text-center">
            <img src="${url}" class="preview-img">
            <p class="small mt-1">${file.name}</p>
        </div>`;
    }
</script>

{% endblock %}